<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>UserHome</title>


    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>



<!--    music import      -->
    <link rel="stylesheet" href="ydxx.css">




    <!--  convert to a stylesheet later -->
    <style>

        * {

        }

        .avatar {
            vertical-align: middle;
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }


    </style>


<!--    //favcon-->
    <link rel="icon" type="image/png" sizes="16x16" href="https://live.staticflickr.com/65535/51320697245_9708355788_c.jpg">

<!--      Google Icons -->

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

</head>



<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <!-- Container wrapper -->
    <div class="container">
        <!-- Navbar brand -->
        <a class="navbar-brand me-2" href="">
            FB

            <!--          <a>-->
            <!--&lt;!&ndash;                  src=""&ndash;&gt;-->
            <!--                  height="16"-->
            <!--                  alt=""-->
            <!--                  loading="lazy"-->
            <!--                  style="margin-top: -1px;"-->
            <!--          </a>-->
        </a>

        <!-- Toggle button -->
        <button
                class="navbar-toggler"
                type="button"
                data-mdb-toggle="collapse"
                data-mdb-target="#navbarButtonsExample"
                aria-controls="navbarButtonsExample"
                aria-expanded="false"
                aria-label="Toggle navigation"
        >
            <i class="fas fa-bars"></i>
        </button>

        <!-- Collapsible wrapper -->
        <div class="collapse navbar-collapse" id="navbarButtonsExample">
            <!-- Left links -->
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="#">FBCLONDE ADMIN LOGIN</a>
                </li>
            </ul>
            <!-- Left links -->

            <div class="d-flex align-items-center">
<!--                <button type="button" class="btn btn-link px-3 me-2" href="index">-->
<!--                    Login-->
<!--                </button>-->
<!--                <button type="button" class="btn btn-primary me-3" href="signup">-->
<!--                    Sign up-->
<!--                </button>-->
                <a
                        class="btn btn-dark px-3 material-icons-outlined"
                        href="post"
                        role="button"
                ><i class="material-icons" style="font-size:14px;">create_new_folder</i>POST</a>
                <ul>
                    <!-- More links here... -->

                        <form th:action="@{/logout}" th:method="post">
                            <button class="btn-link btn" style="margin-top: 8px">Logout</button>
                        </form>

                </ul>
            </div>
        </div>
        <!-- Collapsible wrapper -->
    </div>
    <!-- Container wrapper -->
</nav>
<!-- Navbar -->




<!--        Friends-->
<div class="container" style="margin-top: 5%; margin-left: 5%; margin-right:5%; ">
    <div class="row">
        <div class="col-sm overflow-auto scrolling-wrapper" style="max-width: 450px!important;">


            <table class="table overflow-auto " style="width:20%;  margin-top: 5%">
                <thead class="thead-dark">
                <tr>
                    <table class="table">
                        <thead>
                        <tr>
                            <th>id</th>
                            <th>username</th>
                            <th>email</th>
                            <th>cell</th>

                        </tr>
                        </thead>
                        <tbody>
                        <tr style="align-items: center" th:each="user : ${allusers}">

                            <td style="align-items: center"  th:text="${user.id}"></td>
                            <td style="align-items: center"  th:text="${user.username}">
                            <td style="align-items: center"  th:text="${user.email}">
                            <td style="align-items: center"  th:text="${user.mobile}">

<!--                    need to add action and method    action="/products/delete" method="post"-->

<!--                                <form>-->
<!--                                    <input type="hidden" name="user_id" value="${user.id}">-->
<!--                                    <input class="btn btn-danger btn-sm" type="submit" value="Delete">-->
<!--                                </form>-->
                            </td>
                        </tr>
                        </tbody>
                    </table>



                </tr>
                </thead>

            </table>




            <!--    Group List-->


            <table class="table overflow-auto " style="width:20%;  margin-top: 5%">
                <thead class="thead-dark">
                <tr>
                    <table class="table">
                        <thead>
                        <tr style="align-items: center" th:each="posts : ${allposts}">
                            <th>id</th>
                            <th>group name</th>
                            <th>CreatedBy</th>
                            <th th:href="@{posts.imgPath}"></th>

                        </tr>
                        </thead>
                        <tbody>
                        <tr style="align-items: center" th:each="groups : ${allgroups}">

                            <td style="align-items: center"  th:text="${groups.id}"></td>
                            <td style="align-items: center"  th:text="${groups.title}"></td>
                            <td style="align-items: center"  th:text="${groups.createdBy}"></td>

                                <!--                    need to add action and method    action="/products/delete" method="post"-->

                                <form>
                                    <input type="hidden" name="user_id" value="${user.id}">
                                    <input class="btn btn-danger btn-sm" text="" type="submit" value="Delete">
                                </form>
                            </td>
                        </tr>
                        </tbody>
                    </table>



                </tr>
                </thead>

            </table>


        </div>
        <!--  ^ End of column div     -->



<!--        AN EXAMPLE-->

<!--        <th scope="col">Posts</th>-->

<!--        <div th:if="${'userPosts'}">-->
<!--            <div th:text="${'postId'}">ID</div>-->
<!--            <div th:text="${'userPosts.title'}">Title</div>-->
<!--            <div th:text="${'userPosts.owner.username'}"></div>-->
<!--        </div>-->



        <!-- END OF REFRESH EXAMPLE -->

        <!--      USERS POSTS DIV   -->
        <div class="col-lg-9" style="border-color: red; border-style: solid; height:100% ">

            ALL POST


            <!--              UserPost        style="max-height: 400px;      -->
            <div class="container userPost" style="height:100%">



                <!--          Start of posting div-->
                <div class="row postingDiv" style="display: flex; justify-content: center">
                    <table class="table overflow-auto " style="width:20%;  margin-top: 5%">
                        <thead class="thead-dark">
                        <tr>
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Body of Post </th>
                                    <th>img path</th>
                                    <th>Owner</th>

                                </tr>
                                </thead>
                                <tbody>
                                <tr style="align-items: center" th:each="usersPost : ${allposts}">

                                    <td style="align-items: center"  th:text="${usersPost.title}"></td>
                                    <td style="align-items: center"  th:text="${usersPost.body}"></td>
                                    <img style="align-items: center"  th:text="${usersPost.imgPath}">

<!--                                    <td style="align-items: center"  th:text="${usersPost.owner}"   owner is not working    >-->

                                        <!--                    need to add action and method    action="/products/delete" method="post"-->

                                        <form>
                                            <input type="hidden" name="user_id" value="${user.id}">
                                            <input class="btn btn-danger btn-sm" text="" type="submit" value="Delete">
                                        </form>
                                    </td>
                                </tr>
                                </tbody>
                            </table>



                        </tr>
                        </thead>

                    </table>

            </div>






<!--            &lt;!&ndash;              UserPost        style="max-height: 400px;      &ndash;&gt;-->
<!--            <div class="container userPost">-->



<!--                <div class="row">-->

<!--                    &lt;!&ndash;            Avatar && Username && Status Update   &ndash;&gt;-->
<!--                    <div class="col-sm" style="border-color: #00AAFF; border-style: solid; align-content: center; align-items: center; justify-content: center">-->
<!--                        <img src="https://www.w3schools.com/howto/img_avatar.png" alt="Avatar" class="avatar">-->
<!--                        <div class="col-sm">UserName</div>-->
<!--                        <div class="col-sm">StatusUpdate</div>-->
<!--                    </div>-->


<!--                    &lt;!&ndash;            The Main User Posts                         &ndash;&gt;-->
<!--                    <div class="col-lg-9" style="border-color: #00AAFF; border-style: solid">-->


<!--                        <div id="carouselExampleSlidesOnly" class="carousel slide" data-ride="carousel">-->
<!--                            <div class="carousel-inner">-->
<!--                                <div class="carousel-item active">-->
<!--                                    <img class="d-block w-100" src="https://live.staticflickr.com/65535/51266844876_e00121a287_b.jpg" alt="First slide">-->
<!--                                </div>-->
<!--                                <div class="carousel-item">-->
<!--                                    <img class="d-block w-100" src="https://live.staticflickr.com/65535/51266106377_cf2afa3279_h.jpg" alt="Second slide">-->
<!--                                </div>-->
<!--                                <div class="carousel-item">-->
<!--                                    <img class="d-block w-100" src="https://live.staticflickr.com/65535/51260503839_fd075699a5_h.jpg" alt="Third slide">-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->

















                <!--               END OF USER POST-->



            </div>
        </div>

    </div>


    <section id="wrapper">
        <canvas></canvas>

        <section id="controls">

            <button data-playing="null" class="controls__button">
                <span>Play/Pause</span>
            </button>

            <section class="controls__credit">

                <p>Music by</p>

                <p class="credit--artist">
                    <a href="https://2xaa.fm/" labelledby="artist">
                        <span id="artist">2xaa</span>
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="-537.4 426.7 840.8 229.4"><path class="st0" d="M-92,492.1l-0.2-0.2h-99.3l-25.1,33.1l99,130.8l0.2,0.2h50.7l-49.3-65.2h48.1l49.2,65l0.1,0.2h50.7L-92,492.1z
		 M-141.5,557.1l-23.9-31.6h48.1l23.9,31.6H-141.5z M154.9,426.9l-0.2-0.2h-543.6L-512.5,590l-24.9,32.9l25.1,33.1h346.9l-75.1-99.2
		l-49.6,65.6h-48.1l73.7-97.3l-25.3-33.5l-49.6,65.6h-49.4l-25.5,33.6h49.3l-23.9,31.6h-97.5l73.3-96.8h49.4l25.5-33.6h-49.4
		l23.9-31.6h98.3l24.9,33l24.9-33h345.1l122.7,162.1h-48.1l-98.6-130.3l-0.1-0.2H6.1L-19,525.1l99,130.8l0.2,0.2h50.7l-49.4-65.2
		h48.1l49.2,65l0.2,0.2h99.3l25.1-33.1L154.9,426.9z M56,557.1l-23.9-31.6h48.1l23.9,31.6H56z" /></svg>
                    </a>
                </p>
            </section>

            <section class="controls__credit">

                <p>on</p>

                <p class="credit--platform">
                    <a href="https://soundcloud.com/2xaa" labelledby="platform">
                        <span id="platform">Soundcloud</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M111.4 256.3l5.8 65-5.8 68.3c-.3 2.5-2.2 4.4-4.4 4.4s-4.2-1.9-4.2-4.4l-5.6-68.3 5.6-65c0-2.2 1.9-4.2 4.2-4.2 2.2 0 4.1 2 4.4 4.2zm21.4-45.6c-2.8 0-4.7 2.2-5 5l-5 105.6 5 68.3c.3 2.8 2.2 5 5 5 2.5 0 4.7-2.2 4.7-5l5.8-68.3-5.8-105.6c0-2.8-2.2-5-4.7-5zm25.5-24.1c-3.1 0-5.3 2.2-5.6 5.3l-4.4 130 4.4 67.8c.3 3.1 2.5 5.3 5.6 5.3 2.8 0 5.3-2.2 5.3-5.3l5.3-67.8-5.3-130c0-3.1-2.5-5.3-5.3-5.3zM7.2 283.2c-1.4 0-2.2 1.1-2.5 2.5L0 321.3l4.7 35c.3 1.4 1.1 2.5 2.5 2.5s2.2-1.1 2.5-2.5l5.6-35-5.6-35.6c-.3-1.4-1.1-2.5-2.5-2.5zm23.6-21.9c-1.4 0-2.5 1.1-2.5 2.5l-6.4 57.5 6.4 56.1c0 1.7 1.1 2.8 2.5 2.8s2.5-1.1 2.8-2.5l7.2-56.4-7.2-57.5c-.3-1.4-1.4-2.5-2.8-2.5zm25.3-11.4c-1.7 0-3.1 1.4-3.3 3.3L47 321.3l5.8 65.8c.3 1.7 1.7 3.1 3.3 3.1 1.7 0 3.1-1.4 3.1-3.1l6.9-65.8-6.9-68.1c0-1.9-1.4-3.3-3.1-3.3zm25.3-2.2c-1.9 0-3.6 1.4-3.6 3.6l-5.8 70 5.8 67.8c0 2.2 1.7 3.6 3.6 3.6s3.6-1.4 3.9-3.6l6.4-67.8-6.4-70c-.3-2.2-2-3.6-3.9-3.6zm241.4-110.9c-1.1-.8-2.8-1.4-4.2-1.4-2.2 0-4.2.8-5.6 1.9-1.9 1.7-3.1 4.2-3.3 6.7v.8l-3.3 176.7 1.7 32.5 1.7 31.7c.3 4.7 4.2 8.6 8.9 8.6s8.6-3.9 8.6-8.6l3.9-64.2-3.9-177.5c-.4-3-2-5.8-4.5-7.2zm-26.7 15.3c-1.4-.8-2.8-1.4-4.4-1.4s-3.1.6-4.4 1.4c-2.2 1.4-3.6 3.9-3.6 6.7l-.3 1.7-2.8 160.8s0 .3 3.1 65.6v.3c0 1.7.6 3.3 1.7 4.7 1.7 1.9 3.9 3.1 6.4 3.1 2.2 0 4.2-1.1 5.6-2.5 1.7-1.4 2.5-3.3 2.5-5.6l.3-6.7 3.1-58.6-3.3-162.8c-.3-2.8-1.7-5.3-3.9-6.7zm-111.4 22.5c-3.1 0-5.8 2.8-5.8 6.1l-4.4 140.6 4.4 67.2c.3 3.3 2.8 5.8 5.8 5.8 3.3 0 5.8-2.5 6.1-5.8l5-67.2-5-140.6c-.2-3.3-2.7-6.1-6.1-6.1zm376.7 62.8c-10.8 0-21.1 2.2-30.6 6.1-6.4-70.8-65.8-126.4-138.3-126.4-17.8 0-35 3.3-50.3 9.4-6.1 2.2-7.8 4.4-7.8 9.2v249.7c0 5 3.9 8.6 8.6 9.2h218.3c43.3 0 78.6-35 78.6-78.3.1-43.6-35.2-78.9-78.5-78.9zm-296.7-60.3c-4.2 0-7.5 3.3-7.8 7.8l-3.3 136.7 3.3 65.6c.3 4.2 3.6 7.5 7.8 7.5 4.2 0 7.5-3.3 7.5-7.5l3.9-65.6-3.9-136.7c-.3-4.5-3.3-7.8-7.5-7.8zm-53.6-7.8c-3.3 0-6.4 3.1-6.4 6.7l-3.9 145.3 3.9 66.9c.3 3.6 3.1 6.4 6.4 6.4 3.6 0 6.4-2.8 6.7-6.4l4.4-66.9-4.4-145.3c-.3-3.6-3.1-6.7-6.7-6.7zm26.7 3.4c-3.9 0-6.9 3.1-6.9 6.9L227 321.3l3.9 66.4c.3 3.9 3.1 6.9 6.9 6.9s6.9-3.1 6.9-6.9l4.2-66.4-4.2-141.7c0-3.9-3-6.9-6.9-6.9z"/></svg>
                    </a>
                </p>


                <script>

                    console.clear();

                    // some utility functions
                    const arrAvg = arr => arr.reduce((a,b) => a + b, 0) / arr.length;

                    // at some point refactor this to use viz colours
                    // const colourPalette =

                    //~~~~~~~~~~~~~~~~~~~~~~~~~SOUNDCLOUD STUFF
                    // Massive thanks to @jake_albaugh for letting me use his key. Also a lot of the soundcloud stuff is influenced by https://codepen.io/jakealbaugh/pen/MyJXoK?editors=0010 which you should check out!
                    const track_id = "472062501";
                    const client_id = "787c22af89922d1be9202d2f0cc90586";
                    const src_url = "https://api.soundcloud.com/tracks/" + track_id + "/stream?client_id=" + client_id;

                    const controls = document.querySelector('button');
                    let track = new Audio();

                    function initTrack(url, trackInstance) {
                        let trackInst = trackInstance;
                        trackInst.src = url;
                        trackInst.crossOrigin = "anonymous";
                        trackInst.play();
                    }

                    function playPause(playing, trackInstance) {
                        let trackInst = trackInstance;
                        if (playing) {
                            trackInst.pause();
                        } else {
                            trackInst.play();
                        }
                    }

                    controls.addEventListener("click", function() {
                        this.classList.toggle('button--on');

                        // autoplay policy check
                        if (audCtx.state === 'suspended') {
                            audCtx.resume();
                        }

                        // first click - initiate soundcloud call
                        if (this.dataset.playing === 'null') {
                            initTrack(src_url, track);
                            this.dataset.playing = "true";
                            // and set up audio graph
                            connectGraph(audCtx, track, analyserNode);
                        } else { // toggle play
                            let play = this.dataset.playing === "true" ? true : false;
                            this.dataset.playing = this.dataset.playing === "true" ? "false" : "true";
                            playPause(play, track);
                        }

                    }, false);

                    //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ AUDIO STUFF
                    // set up audio context & analyser
                    const binSize = 128;
                    let bin = new Uint8Array(binSize);
                    const audCtx = new (window.AudioContext || window.webkitAudioContext);
                    const analyserNode = new AnalyserNode(audCtx, {
                        fftSize: binSize*2,
                        maxDecibels: -25,
                        minDecibels: -60,
                        smoothingTimeConstant: 0.5,
                    });

                    function connectGraph(ctx, trackInstance, node) {
                        let trackInst = trackInstance,
                            audioCtx = ctx,
                            analyserNode = node;
                        const source = audioCtx.createMediaElementSource(trackInst);
                        source.connect(analyserNode).connect(audioCtx.destination);
                    }

                    function analyse(node) {
                        let analyserNode = node;
                        analyserNode.getByteFrequencyData(bin);
                        // console.log(bin);
                    }

                    //~~~~~~~~~~~~~~~~~~~~CANVAS STUFF
                    // draw the stuff!
                    const canvas = document.querySelector('canvas'),
                        width = window.innerWidth,
                        height = window.innerHeight;
                    canvas.width = width;
                    canvas.height = height;
                    const canCtx = canvas.getContext('2d');
                    canCtx.strokeStyle = 'white';
                    canCtx.lineWidth = 2;

                    // visual setup
                    const step = 24; // size
                    const beatThreshold = 45; // average gain for change
                    const debounceRate = 5; // lower = higher frame count
                    let debounce = 0;

                    function draw(ctx) {
                        requestAnimationFrame(draw);
                        analyse(analyserNode);
                        let newBin = bin.slice(0, binSize/2);
                        // console.log(newBin);

                        // if the first half of the array averages over 200, change lines
                        let binAvg = arrAvg(newBin);
                        // console.log(binAvg);
                        // HERE NEITHER CLEARRECT NOR DRAWING A NEW ONE WORKS?
                        if ( (binAvg > beatThreshold) && (debounce === 0) ) {
                            canCtx.clearRect(0,0,width,height);
                            makeSteps();
                            debounce = debounceRate;
                        }

                        debounce > 0 ? debounce-- : debounce = 0;
                        // each line is an item in the array
                        // if the value goes above 200 flash
                    }

                    function makeSteps() {
                        for( let x = 0; x < width; x += step) {
                            for( let y = 0; y < height; y += step ) {
                                makeLine(canCtx, x, y, step, step);
                            }
                        }
                    }

                    function makeLine(ctx, x, y, width, height) {
                        let leftToRight = Math.random() >= 0.5;

                        ctx.beginPath();

                        if( leftToRight ) {
                            ctx.moveTo(x, y);
                            ctx.lineTo(x + width, y + height);
                        } else {
                            ctx.moveTo(x + width, y);
                            ctx.lineTo(x, y + height);
                        }

                        ctx.closePath();
                        ctx.stroke();
                    }

                    draw(canCtx);


                </script>
            </section>
        </section>

    </section>
</div>


<style>

</style>





</div>
</body>
</html>